<!doctype html>
<html>
  <head>
  </head>
  <body>
    <h2>Use this to demonstrate send and receive to socket server</h2>
    <h3>Type in the input and click "Analyze". If your message includes an emoji, it will be reported below.</h3>
    <form>
      <input autofocus id="input" />
      <input type="submit" value="Analyze" />
    </form>
    <p id="time"></p>
    <p id="response"></p>
    <script src="object_hash.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
      const id = objectHash(performance.now()).slice(0, 10);
      const port = /***PORT***/; // this is replaced by the server
      const endpoint = location.origin.replace(/:\d.*/, `:${port}`);
      const transports = ['websocket', 'polling'];

      console.log('id', id);
      console.log('endpoint', endpoint);
      const socket = io(endpoint, {
        transports,
        auth: {
          chat: {
            id
          }
        }
      });

      const form = document.querySelector('form');
      const input = document.getElementById('input');
      const response = document.getElementById('response');
      const submit = document.querySelector('input[type=submit]');
      const time = document.getElementById('time');

      const onSubmit = () => {
        const message = input.value;
        socket.emit('request', {
          chat: {
            id
          },
          message
        })
      };

      form.onsubmit = event => {
        onSubmit();
        return false;
      };

      socket.on('time', (timeString) => {
        time.innerHTML = `Server time: ${timeString}`;
      });

      socket.on('response', data => {
        const outcome = `The text "${data.message}" ${data.result ? 'contains an emoji' : 'does not contain an emoji'}`;
        response.innerHTML = outcome;
      });
    </script>
  </body>
</html>
